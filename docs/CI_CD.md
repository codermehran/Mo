# مستندات سیستم یکپارچه‌سازی و تحویل مداوم (CI/CD)

این سند فرآیند انتشار خودکار نسخه، ساخت (Build) و مدیریت نسخه‌ها را در این مخزن شرح می‌دهد. این سیستم بر اساس استانداردهای روز و با استفاده از اسکریپت‌نویسی دستی (Bash Scripting) پیاده‌سازی شده است.

## نمای کلی
سیستم طراحی شده به صورت خودکار با هر تغییر (Push) در شاخه اصلی (`main` یا `master`) فعال شده و مراحل زیر را به ترتیب اجرا می‌کند:

1. **محاسبه نسخه جدید**: بر اساس آخرین تگ موجود در مخزن، نسخه جدید با افزایش `0.0.1` محاسبه می‌شود. اگر تگی وجود نداشته باشد، نسخه از `1.0.0` شروع می‌شود.
2. **برچسب‌گذاری (Tagging)**: تگ نسخه جدید ایجاد و به مخزن ارسال می‌شود.
3. **ساخت پروژه (Build)**: کدهای فرانت‌اند (Next.js) و بک‌اند (Python) آماده‌سازی شده و در قالب یک فایل فشرده (`zip`) بسته‌بندی می‌شوند.
4. **انتشار (Release)**: فایل نهایی به عنوان یک Release در گیت‌هاب ثبت می‌شود.
5. **پاکسازی خودکار**: جهت مدیریت فضای ذخیره‌سازی، سیستم لیست نسخه‌ها را بررسی کرده و تنها دو نسخه آخر را نگه می‌دارد؛ نسخه‌های قدیمی‌تر حذف می‌شوند.

## ساختار اسکریپت‌ها
اسکریپت‌های اجرایی در پوشه `scripts/` قرار دارند:

### ۱. `scripts/get_next_version.sh`
این اسکریپت وظیفه تعیین شماره نسخه بعدی را بر عهده دارد.
- از دستورات Git برای یافتن آخرین تگ استفاده می‌کند.
- از استاندارد نسخه معنایی (Semantic Versioning) تبعیت می‌کند.

### ۲. `scripts/build.sh`
این اسکریپت فرآیند ساخت را مدیریت می‌کند:
- وارد پوشه `beauty-platform/frontend` شده و دستورات `npm install` و `npm run build` را اجرا می‌کند.
- پوشه پروژه را با حذف فایل‌های غیرضروری (مانند `node_modules`, `.git`) فشرده می‌کند.
- خروجی یک فایل با نام `release_<version>.zip` خواهد بود.

### ۳. `scripts/manage_release.sh`
این اسکریپت مدیر اصلی فرآیند است:
- تنظیمات اولیه Git را انجام می‌دهد.
- نسخه جدید را دریافت و تگ‌گذاری می‌کند.
- اسکریپت ساخت را فراخوانی می‌کند.
- با استفاده از ابزار `gh` (GitHub CLI) نسخه را در گیت‌هاب منتشر می‌کند.
- منطق نگهداری تنها دو نسخه آخر را اجرا می‌کند.

## پیکربندی گردش کار (Workflow)
فایل `.github/workflows/auto_release.yml` وظیفه اجرای این اسکریپت‌ها را در محیط GitHub Actions بر عهده دارد.
- این گردش کار روی شاخه‌های اصلی فعال می‌شود.
- دسترسی‌های لازم (Permissions) برای نوشتن در مخزن را دارد.
- محیط‌های لازم (Node.js 20, Python 3.10) را راه‌اندازی می‌کند.

## نحوه استفاده
این سیستم کاملاً خودکار است. کافیست تغییرات خود را در شاخه اصلی Push کنید:

```bash
git add .
git commit -m "Add new feature"
git push origin main
```

سیستم به طور خودکار نسخه را ارتقا داده و منتشر می‌کند.
